<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pague Leve — Checkout</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Meta Pixel -->
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
  document,'script','https://connect.facebook.net/en_US/fbevents.js');
  fbq('init','750766562712140');
  fbq('track','PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=750766562712140&ev=PageView&noscript=1"/>
  </noscript>
</head>

<body class="bg-gray-100 min-h-screen">
  <header class="w-full bg-amber-400 text-black">
    <div class="max-w-md mx-auto px-4 py-2 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <img src="logo-pagueleve.png" alt="Pague Leve" class="h-6">
      </div>
      <div class="flex items-center gap-2 text-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5zm-3 8V7a3 3 0 016 0v3H9z"/></svg>
        <span>Pagamento 100% seguro</span>
      </div>
    </div>
  </header>

  <main class="flex items-start justify-center">
    <form id="checkout-form" class="bg-white p-8 rounded shadow-md w-full max-w-md space-y-4 mt-6" autocomplete="off">
      <input id="cart_id" name="cart_id" type="hidden" />
      <input id="total_cents" name="total_cents" type="hidden" />

      <input id="name" type="text" placeholder="Nome completo" required class="w-full px-4 py-2 border rounded"/>
      <input id="email" type="email" placeholder="E-mail" required class="w-full px-4 py-2 border rounded"/>
      <input id="cpf" type="text" inputmode="numeric" placeholder="CPF (somente números)" required class="w-full px-4 py-2 border rounded"/>
      <input id="phone" type="text" inputmode="numeric" placeholder="Celular (DDD+número)" required class="w-full px-4 py-2 border rounded"/>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Valor (R$)</label>
        <input id="amount" type="text" value="10,00" placeholder="10,00" required class="w-full px-4 py-2 border rounded"/>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">Cupom de desconto (%)</label>
        <div class="flex gap-2">
          <input id="coupon" type="text" placeholder="DIGITE SEU CUPOM" class="flex-1 px-4 py-2 border rounded uppercase"/>
          <button id="apply-coupon" type="button" class="px-4 bg-black text-white rounded">Aplicar</button>
        </div>
        <div id="coupon-msg" class="text-sm mt-1"></div>
      </div>

      <div class="space-y-2">
        <div class="font-semibold">Endereço de entrega</div>
        <div class="grid grid-cols-3 gap-2">
          <input id="cep" class="col-span-1 px-4 py-2 border rounded" inputmode="numeric" placeholder="CEP (00000-000)" required />
          <input id="state" class="col-span-1 px-4 py-2 border rounded" maxlength="2" placeholder="UF" required />
          <input id="city" class="col-span-1 px-4 py-2 border rounded" placeholder="Cidade" required />
        </div>
        <div id="cep-info" class="text-sm text-green-600 font-medium"></div>
        <input id="address1" class="w-full px-4 py-2 border rounded" placeholder="Rua / Avenida" required />
        <div class="grid grid-cols-3 gap-2">
          <input id="number" class="col-span-1 px-4 py-2 border rounded" placeholder="Número" required />
          <input id="neighborhood" class="col-span-1 px-4 py-2 border rounded" placeholder="Bairro" required />
          <input id="complement" class="col-span-1 px-4 py-2 border rounded" placeholder="Complemento" />
        </div>
        <p class="text-xs text-gray-500">Frete grátis. Endereço usado para nota fiscal e entrega.</p>
      </div>

      <div class="space-y-2">
        <label class="font-semibold block">Forma de pagamento</label>
        <div class="flex gap-4">
          <label class="flex items-center gap-2"><input type="radio" name="pmethod" value="pix" checked/>Pix</label>
          <label class="flex items-center gap-2"><input type="radio" name="pmethod" value="boleto"/>Boleto</label>
          <label class="flex items-center gap-2"><input type="radio" name="pmethod" value="card"/>Cartão</label>
        </div>
      </div>

      <div id="card-fields" class="space-y-2 hidden">
        <input id="card_number" type="text" inputmode="numeric" maxlength="19" placeholder="0000 0000 0000 0000" class="w-full px-4 py-2 border rounded"/>
        <div class="grid grid-cols-3 gap-2">
          <input id="exp_month" type="text" inputmode="numeric" maxlength="2" placeholder="MM" class="w-full px-4 py-2 border rounded"/>
          <input id="exp_year" type="text" inputmode="numeric" maxlength="4" placeholder="AAAA" class="w-full px-4 py-2 border rounded"/>
          <input id="cvv" type="text" inputmode="numeric" maxlength="4" placeholder="CVV" class="w-full px-4 py-2 border rounded"/>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Parcelas</label>
          <select id="installments" class="w-full px-4 py-2 border rounded"></select>
          <p class="text-xs text-gray-500 mt-1">* Valores aproximados. Parcelamento com <strong>juros do emissor</strong>.</p>
        </div>
      </div>

      <div>
        <button id="pay-btn" type="submit" class="w-full bg-black text-white font-bold py-2 rounded hover:opacity-90">
          Pagar
        </button>
      </div>

      <div id="status" class="text-center text-sm text-gray-700"></div>
      <div id="extra" class="mt-4 space-y-2 text-sm"></div>

      <footer class="pt-4 text-center text-xs text-gray-500">
        <div class="flex items-center justify-center gap-4">
          <span class="inline-flex items-center gap-1">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V7a5 5 0 00-5-5zM9 10V7a3 3 0 016 0v3H9z"/></svg>
            Pagamento 100% seguro
          </span>
          <span>•</span>
          <span>Pix • Boleto • Cartão</span>
          <span>•</span>
          <span>Processado por Pagar.me</span>
        </div>
      </footer>
    </form>
  </main>

  <script>
    /* funções de cupom, endereço, submit etc. (mesmo que antes) */

    // máscara CPF
    const cpfEl = document.getElementById('cpf');
    if (cpfEl) {
      cpfEl.addEventListener('input', ()=>{
        let v = cpfEl.value.replace(/\D/g,'').slice(0,11);
        v = v.replace(/(\d{3})(\d)/,'$1.$2')
             .replace(/(\d{3})(\d)/,'$1.$2')
             .replace(/(\d{3})(\d{1,2})$/,'$1-$2');
        cpfEl.value = v;
      });
    }

    // máscara PHONE corrigida
    (function () {
      const el = document.getElementById('phone');
      if (!el) return;
      const isDigit = (c) => /\d/.test(c);
      const isSep   = (c) => c === ' ' || c === '-' || c === ')' || c === '(';
      function format(d) {
        d = (d || '').replace(/\D/g, '').slice(0, 11);
        if (!d) return '';
        if (d.length <= 2) return '(' + d;
        if (d.length <= 7) return '(' + d.slice(0,2) + ') ' + d.slice(2);
        return '(' + d.slice(0,2) + ') ' + d.slice(2,7) + '-' + d.slice(7);
      }
      function placeCaretFromDigitsCount(str, count){
        let seen = 0;
        for (let i = 0; i < str.length; i++) {
          if (isDigit(str[i])) seen++;
          if (seen >= count) return i + 1;
        }
        return str.length;
      }
      el.addEventListener('keydown', (ev) => {
        if (ev.key !== 'Backspace') return;
        const pos = el.selectionStart, end = el.selectionEnd, val = el.value;
        if (pos === null || end === null) return;
        if (pos > 0 && pos === end && isSep(val[pos - 1])) {
          ev.preventDefault();
          let digitsBeforeSep = 0;
          for (let i = 0; i < pos - 1; i++) if (isDigit(val[i])) digitsBeforeSep++;
          let digits = val.replace(/\D/g, '');
          if (digitsBeforeSep > 0) {
            const idx = digitsBeforeSep - 1;
            digits = digits.slice(0, idx) + digits.slice(idx + 1);
          }
          const fmt = format(digits);
          el.value = fmt;
          const newPos = placeCaretFromDigitsCount(fmt, Math.max(0, digitsBeforeSep - 1));
          try { el.setSelectionRange(newPos, newPos); } catch (_){}
          return;
        }
      });
      el.addEventListener('input', ()=>{
        const currVal = el.value;
        const currDigits = currVal.replace(/\D/g, '').slice(0, 11);
        let caret = el.selectionStart || 0;
        let digitsBefore = 0;
        for (let i = 0; i < Math.min(caret, currVal.length); i++) {
          if (isDigit(currVal[i])) digitsBefore++;
        }
        const fmt = format(currDigits);
        el.value = fmt;
        const newPos = placeCaretFromDigitsCount(fmt, Math.max(0, digitsBefore));
        try { el.setSelectionRange(newPos, newPos); } catch (_){}
      });
      el.value = format(el.value);
    })();

    // máscara cartão
    const cardEl = document.getElementById('card_number');
    if (cardEl) {
      cardEl.addEventListener('input', ()=>{
        let v = cardEl.value.replace(/\D/g,'').slice(0,16);
        v = v.replace(/(\d{4})(?=\d)/g,'$1 ');
        cardEl.value = v;
      });
    }
  </script>
</body>
</html>
